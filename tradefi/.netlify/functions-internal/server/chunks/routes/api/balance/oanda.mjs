import{d as e,c as a}from"../../../_/nitro.mjs";import{s as r}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"node:crypto";import"consola";import"node:url";import"ipx";import"node:fs";import"node:path";import"@supabase/ssr";const o=e((async e=>{var o;try{if(!e.context.user)throw a({statusCode:401,message:"Unauthorized - Please log in"});const n=await r(e),{data:t,error:c}=await n.from("bot_credentials").select("api_key, account_id, base_url").eq("exchange","oanda").single();if(c||!t)return{success:!1,exchange:"OANDA",error:"OANDA credentials not configured"};const s=t.account_id,i=t.api_key,l=t.base_url||"https://api-fxpractice.oanda.com",u=l.endsWith("/")?l.slice(0,-1):l,p=await $fetch(`${u}/v3/accounts/${s}`,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});if(console.log("OANDA Balance:",null==(o=null==p?void 0:p.account)?void 0:o.balance),!(null==p?void 0:p.account))return{success:!1,exchange:"OANDA",error:"Invalid response from OANDA API"};const d=parseFloat(p.account.balance),m=parseFloat(p.account.unrealizedPL),A=parseFloat(p.account.NAV),g=parseFloat(p.account.marginUsed);return{success:!0,exchange:"OANDA",balance:d,unrealizedPL:m,nav:A,marginUsed:g,marginAvailable:parseFloat(p.account.marginAvailable),currency:p.account.currency,hedgingEnabled:p.account.hedgingEnabled}}catch(e){console.error("OANDA balance error:",e);return{success:!1,exchange:"OANDA",error:e instanceof Error?e.message:"Unknown error occurred"}}}));export{o as default};
//# sourceMappingURL=oanda.mjs.map
