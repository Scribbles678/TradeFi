import{d as a,c as e}from"../../../_/nitro.mjs";import{createHmac as t}from"node:crypto";import{s as o}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"consola";import"node:url";import"ipx";import"node:fs";import"node:path";import"@supabase/ssr";const n=a((async a=>{if(!a.context.user)throw e({statusCode:401,message:"Unauthorized - Please log in"});const n=await o(a),{data:r,error:l}=await n.from("bot_credentials").select("api_key, api_secret").eq("exchange","aster").single();if(l||!r)return{success:!1,exchange:"Aster DEX",balance:null,error:"Aster DEX credentials not configured"};const s=r.api_key,i=r.api_secret;try{const a="https://fapi.asterdex.com"+"/fapi/v4/account",e="GET",o=`timestamp=${Date.now().toString()}`,n=t("sha256",i).update(o).digest("hex"),r=await $fetch(`${a}?${o}&signature=${n}`,{method:e,headers:{"X-MBX-APIKEY":s,"Content-Type":"application/json"}});console.log("Aster DEX Balance:",null==r?void 0:r.totalMarginBalance);const l=(null==r?void 0:r.totalMarginBalance)?parseFloat(r.totalMarginBalance):0;return console.log("Aster DEX Final Balance:",l),{success:!0,exchange:"Aster DEX",balance:l,availableBalance:(null==r?void 0:r.availableBalance)?parseFloat(r.availableBalance):null,totalUnrealizedPnl:(null==r?void 0:r.totalUnrealizedPnl)?parseFloat(r.totalUnrealizedPnl):null,totalMarginBalance:(null==r?void 0:r.totalMarginBalance)?parseFloat(r.totalMarginBalance):null}}catch(a){return console.error("Aster DEX API Error:",a),{success:!1,exchange:"Aster DEX",balance:null,error:a instanceof Error?a.message:String(a)}}}));export{n as default};
//# sourceMappingURL=aster.mjs.map
