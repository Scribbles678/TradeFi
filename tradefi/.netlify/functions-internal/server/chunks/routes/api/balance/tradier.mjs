import{d as e,c as a}from"../../../_/nitro.mjs";import{s as r}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"node:crypto";import"consola";import"node:url";import"ipx";import"node:fs";import"node:path";import"@supabase/ssr";const t=e((async e=>{var t,o;if(!e.context.user)throw a({statusCode:401,message:"Unauthorized - Please log in"});const s=await r(e),{data:n,error:i}=await s.from("bot_credentials").select("api_key, account_id").eq("exchange","tradier").single();if(i||!n)return{success:!1,exchange:"Tradier",balance:null,error:"Tradier credentials not configured"};const c=n.api_key,l=n.account_id;try{const e=await $fetch(`https://sandbox.tradier.com/v1/accounts/${l}/balances`,{headers:{Authorization:`Bearer ${c}`,Accept:"application/json"}});console.log("Tradier API Response:",e);const a=null==e?void 0:e.balances;if(!a)return{success:!1,exchange:"Tradier",balance:null,error:"Invalid response from Tradier API"};const r=a.total_equity,s=a.total_cash,n=a.total_market_value,i=(null==(t=a.buying_power)?void 0:t.cash_available)||0;return{success:!0,exchange:"Tradier",balance:r,totalCash:s,totalMarketValue:n,buyingPower:i,cashAvailable:(null==(o=a.cash)?void 0:o.cash_available)||0,optionMarketValue:a.option_market_value,stockMarketValue:a.stock_market_value}}catch(e){return console.error("Tradier API Error:",e),{success:!1,exchange:"Tradier",balance:null,error:e instanceof Error?e.message:String(e)}}}));export{t as default};
//# sourceMappingURL=tradier.mjs.map
