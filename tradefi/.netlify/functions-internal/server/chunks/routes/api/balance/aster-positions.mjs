import{d as t,a as o}from"../../../_/nitro.mjs";import{createHmac as e}from"node:crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"consola";import"node:url";import"ipx";import"node:fs";import"node:path";const s=t((async t=>{var s;const n=o(),r=n.asterApiKey,i=n.asterApiSecret;try{const t="https://fapi.asterdex.com"+"/fapi/v4/account",o="GET",n=`timestamp=${Date.now().toString()}`,a=e("sha256",i).update(n).digest("hex"),p=await $fetch(`${t}?${n}&signature=${a}`,{method:o,headers:{"X-MBX-APIKEY":r,"Content-Type":"application/json"}});console.log("Aster DEX Account API Response:",p),console.log("Aster DEX Positions from account:",(null==(s=null==p?void 0:p.positions)?void 0:s.length)||0,"positions found");const l=((null==p?void 0:p.positions)||[]).filter((t=>0!==parseFloat(t.positionAmt)));console.log("Aster DEX Active Positions (before filtering):",l.length);const c=l.filter((t=>{const o=(t.symbol||"").toUpperCase(),e=o.includes("_")&&o.match(/^[A-Z]{3}_[A-Z]{3}$/),s=o.includes("/")&&o.match(/^[A-Z]{3}\/[A-Z]{3}$/);return!e&&!s}));if(console.log("Aster DEX Crypto Positions (after filtering):",c.length),l.length!==c.length){const t=l.filter((t=>!c.includes(t)));console.log("Aster DEX Filtered out non-crypto positions:",t.map((t=>t.symbol)))}const m=c.map((t=>({id:`${t.symbol}_${t.positionSide}`,symbol:t.symbol,side:parseFloat(t.positionAmt)>0?"BUY":"SELL",entry_price:parseFloat(t.entryPrice),current_price:parseFloat(t.markPrice),quantity:Math.abs(parseFloat(t.positionAmt)),position_size_usd:Math.abs(parseFloat(t.notional)),unrealized_pnl_usd:parseFloat(t.unrealizedProfit),unrealized_pnl_percent:parseFloat(t.unrealizedProfit)/Math.abs(parseFloat(t.notional))*100,entry_time:(new Date).toISOString(),exchange:"aster",asset_class:"crypto"})));return{success:!0,exchange:"Aster DEX",positions:m,count:m.length}}catch(t){return console.error("Aster DEX Positions API Error:",t),{success:!1,exchange:"Aster DEX",positions:[],count:0,error:t instanceof Error?t.message:String(t)}}}));export{s as default};
//# sourceMappingURL=aster-positions.mjs.map
