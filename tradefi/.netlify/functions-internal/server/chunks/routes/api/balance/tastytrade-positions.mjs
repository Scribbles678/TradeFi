import{d as t,a as e}from"../../../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"node:crypto";import"consola";import"node:url";import"ipx";import"node:fs";import"node:path";const s=t((async t=>{var s;const a=e(),r=a.tastytradeClientId,n=a.tastytradeClientSecret,o=a.tastytradeUsername,i=a.tastytradePassword,d=a.tastytradeAccountId;if(!(r&&n&&o&&i&&d))return{success:!1,exchange:"Tasty Trade",positions:[],count:0,error:"Tasty Trade is not configured (disabled)",disabled:!0};try{const t=await $fetch("/api/auth/tastytrade-token");if(!t.success)return t.disabled?{success:!1,exchange:"Tasty Trade",positions:[],count:0,error:"Tasty Trade is disabled",disabled:!0}:{success:!1,exchange:"Tasty Trade",positions:[],count:0,error:`OAuth2 token failed: ${t.error}`};const e=t.access_token,a=await $fetch(`https://api.tastytrade.com/accounts/${d}/positions`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});console.log("Tasty Trade Positions API Response:",a);const r=((null==(s=null==a?void 0:a.data)?void 0:s.items)||[]).filter((t=>0!==t.quantity));console.log("Tasty Trade Active Positions:",r.length);const n=r.map((t=>{const e=t.quantity>0?"BUY":"SELL",s=Math.abs(t.quantity);return{id:`${t.symbol}_${e}`,symbol:t.symbol,side:e,entry_price:t.average_price,current_price:t.average_price,quantity:s,position_size_usd:Math.abs(t.market_value),unrealized_pnl_usd:t.unrealized_pnl,unrealized_pnl_percent:0!==t.market_value?t.unrealized_pnl/Math.abs(t.market_value)*100:0,entry_time:(new Date).toISOString(),exchange:"tastytrade",asset_class:"futures",instrument_type:t.instrument_type,underlying_symbol:t.underlying_symbol,expiration_date:t.expiration_date,strike_price:t.strike_price,option_type:t.option_type}}));return{success:!0,exchange:"Tasty Trade",positions:n,count:n.length}}catch(t){const e=t instanceof Error?t.message:String(t),s=e.includes("401")||e.includes("Unauthorized");return s||console.error("Tasty Trade Positions API Error:",t),{success:!1,exchange:"Tasty Trade",positions:[],count:0,error:s?"Tasty Trade is disabled (invalid credentials)":e,disabled:!0}}}));export{s as default};
//# sourceMappingURL=tastytrade-positions.mjs.map
