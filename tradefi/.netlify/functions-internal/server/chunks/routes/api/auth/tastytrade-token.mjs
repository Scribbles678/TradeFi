import{d as e,a as t}from"../../../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"node:crypto";import"consola";import"node:url";import"ipx";import"node:fs";import"node:path";const s=e((async e=>{const s=t(),o=s.tastytradeClientId,r=s.tastytradeClientSecret,a=s.tastytradeUsername,n=s.tastytradePassword;if(!(o&&r&&a&&n))return{success:!1,error:"Tasty Trade is not configured (disabled)",disabled:!0};try{const e=await $fetch("https://api.tastytrade.com/auth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:new URLSearchParams({grant_type:"password",client_id:o,client_secret:r,username:a,password:n,scope:"read"})});return console.log("Tasty Trade OAuth2 Token Response:",e),(null==e?void 0:e.access_token)?{success:!0,access_token:e.access_token,token_type:e.token_type,expires_in:e.expires_in,scope:e.scope}:{success:!1,error:"Failed to obtain OAuth2 token from Tasty Trade"}}catch(e){let t=!1,s="Unknown error occurred";if(e&&"object"==typeof e){const o=e;401!==o.status&&401!==o.statusCode||(t=!0),s=o.message||o.statusText||String(e)}else e instanceof Error&&(s=e.message);return t||(t=s.includes("401")||s.includes("Unauthorized")||s.toLowerCase().includes("unauthorized")),t||console.error("Tasty Trade OAuth2 error:",e),{success:!1,error:t?"Tasty Trade is disabled (invalid credentials)":s,disabled:!0}}}));export{s as default};
//# sourceMappingURL=tastytrade-token.mjs.map
