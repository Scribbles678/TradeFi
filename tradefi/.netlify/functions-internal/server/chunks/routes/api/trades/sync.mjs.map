{"version":3,"file":"sync.mjs","sources":["../../../../../../../server/api/trades/sync.ts"],"sourcesContent":null,"names":["sync","defineEventHandler","async","event","config","useRuntimeConfig","console","log","asterApiKey","asterApiSecret","oandaApiKey","oandaBaseUrl","oandaAccountId","currentApiPositions","Map","closedTrades","baseUrl","endpoint","queryString","Date","now","toString","signature","createHmac","update","digest","asterResponse","$fetch","method","headers","asterPositions","positions","filter","pos","symbol","toUpperCase","isForexPair","includes","match","isForexPairSlash","parseFloat","positionAmt","forEach","key","positionSide","quantity","Math","abs","entryPrice","currentPrice","markPrice","positionSizeUsd","notional","unrealizedPnl","unrealizedProfit","unrealizedPnlPercent","set","exchange","asset_class","entry_price","current_price","position_size_usd","unrealized_pnl_usd","unrealized_pnl_percent","side","length","error","cleanBaseUrl","endsWith","slice","oandaResponse","Authorization","oandaPositions","longUnits","_a","long","units","shortUnits","_b","short","isLong","_c","averagePrice","_d","_e","unrealizedPL","_f","e","instrument","savedPositionsMap","apiPos","entries","existingPos","getOpenPositions","find","p","updatePosition","id","updated_at","toISOString","newPosition","savePosition","entry_time","supabasePositions","recentTrades","getRecentTrades","existingTradeKeys","Set","map","t","supabasePos","positionKey","toLowerCase","has","tradeKey","exitPrice","assetClass","pnlUsd","pnlPercent","exit_price","calculated_pnl_usd","calculated_pnl_percent","warn","tradeData","exit_time","stop_loss_price","take_profit_price","stop_loss_percent","take_profit_percent","pnl_usd","toFixed","pnl_percent","is_winner","exit_reason","notes","push","savedTrades","savedTrade","saveTrade","success","message","trades","count","Error","String"],"mappings":"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"}