import{a as e}from"./nitro.mjs";import{createClient as s}from"@supabase/supabase-js";let r=null,n=null;function useSupabaseClient(){if(r)return r;const n=e(),a=n.public.supabaseUrl,o=n.public.supabaseKey;return function(e,s){if(!e||!s)throw new Error("Supabase environment variables are missing. Ensure SUPABASE_URL and SUPABASE_ANON_KEY are set.")}(a,o),r=s(a,o),r}function useServiceSupabaseClient(){if(n)return n;const r=e(),a=r.public.supabaseUrl,o=r.supabaseServiceRoleKey;if(!a||!o)throw new Error("Supabase service role configuration is missing. Set SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY in the environment.");return n=s(a,o),n}async function getOpenPositions(e){let s=useSupabaseClient().from("positions").select("*");e&&(s=s.eq("asset_class",e));const{data:r,error:n}=await s.order("created_at",{ascending:!1});return console.log("Supabase Positions Query:",{assetClass:e,dataCount:(null==r?void 0:r.length)||0,error:(null==n?void 0:n.message)||"none"}),n?(console.error("Error fetching positions:",n),[]):r||[]}async function getRecentTrades(e=20,s){let r=useSupabaseClient().from("trades").select("*");const{data:n,error:a}=await r.order("exit_time",{ascending:!1}).limit(e);return a?(console.error("Error fetching trades:",a),[]):n||[]}async function saveTrade(e){const s=useServiceSupabaseClient(),{data:r,error:n}=await s.from("trades").insert([e]).select().single();return n?(console.error("Error saving trade:",n),null):(console.log("Trade saved successfully:",r),r)}async function saveTrades(e){const s=useServiceSupabaseClient(),{data:r,error:n}=await s.from("trades").insert(e).select();return n?(console.error("Error saving trades:",n),null):(console.log(`${e.length} trades saved successfully`),r)}async function savePosition(e){const s=useServiceSupabaseClient(),{data:r,error:n}=await s.from("positions").insert([e]).select().single();return n?(console.error("Error saving position:",n),null):(console.log("Position saved successfully:",r),r)}async function updatePosition(e,s){const r=useServiceSupabaseClient(),{data:n,error:a}=await r.from("positions").update(s).eq("id",e).select().single();return a?(console.error("Error updating position:",a),null):n}export{updatePosition as a,saveTrade as b,saveTrades as c,getRecentTrades as d,getOpenPositions as g,savePosition as s,useServiceSupabaseClient as u};
//# sourceMappingURL=supabase.mjs.map
